@model CustomerModel 

<div class="container">

    <div class="bs-example">
        <div class="container">
            <div class="row">
                <div class="col-md-12  text-right">

                    <button type="button" class="btn btn-primary ml-2" id="addCustomerButton">Add Customer</button>
                </div>
            </div>
        </div>
    </div>

    <div class="bs-example">
        <div class="container">
            <div class="row">
                <div class="col-md-12 bg-light text-right">
                </div>
            </div>
        </div>
    </div>

   
  
    <div id="addCustomerModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Customer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                 
                    <form id="addCustomerForm">
                        <div class="form-group">
                            <label for="customerName">Customer Name</label>
                            <input type="text" class="form-control" id="customerName" name="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="mobile">Mobile</label>
                            <input type="text" class="form-control" id="mobile" name="mobile" required>
                        </div>
                        <div class="form-group">
                            <label for="address">Address</label>
                            <input type="text" class="form-control" id="address" name="address" required>
                        </div>
                        <div class="form-group">
                            <label for="telephone">Telephone</label>
                            <input type="text" class="form-control" id="telephone" name="telephone" required>
                        </div>
                        <div class="form-group">
                            <label for="fax">Fax</label>
                            <input type="text" class="form-control" id="fax" name="fax" required>
                        </div>
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="VIP">VIP</option>
                                <option value="Regular">Regular</option>
                                <option value="Eternal">Eternal</option>
                                <option value="External">External</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="close">Close</button>
                    <button type="button" class="btn btn-primary" id="saveCustomerButton">Save</button>
                </div>
            </div>
        </div>
    </div>
 
    <div id="updateCustomerModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Customer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
               
                    <form id="updateCustomerForm">
                        <div class="form-group">
                            <label for="customerName">Customer Name</label>
                            <input type="text" class="form-control" id="ucustomerName" name="ucustomerName" required>
                        </div>
                        <div class="form-group">
                            <label for="mobile">Mobile</label>
                            <input type="text" class="form-control" id="umobile" name="umobile" required>
                        </div>
                        <div class="form-group">
                            <label for="address">Address</label>
                            <input type="text" class="form-control" id="uaddress" name="uaddress" required>
                        </div>
                        <div class="form-group">
                            <label for="telephone">Telephone</label>
                            <input type="text" class="form-control" id="utelephone" name="utelephone" required>
                        </div>
                        <div class="form-group">
                            <label for="fax">Fax</label>
                            <input type="text" class="form-control" id="ufax" name="ufax" required>
                        </div>
                      

                        <input type="hidden"  id="uid" name="uid" >
                       
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select class="form-control" id="ucategory" name="ucategory" required>
                                <option value="VIP">VIP</option>
                                <option value="Regular">Regular</option>
                                <option value="Eternal">Eternal</option>
                                <option value="External">External</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="close">Close</button>
                    <button type="button" class="btn btn-primary" id="updateCustomerButton">Save</button>
                </div>
            </div>
        </div>
    </div>
<div class="container">

        <h2>Customers Table <input type="text" id="CustomerName" class="form-control" placeholder="Search By Customer Name ..." /></h2>
    <table id="customerTable" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Customer Name</th>
                <th>Mobile</th>
                <th>Address</th>
                <th>Telephone</th>
                <th>Fax</th>
                <th>Category</th>
                <th>Invoices</th>
                <th>Action</th>
            </tr>
        </thead>

    </table>

</div>
</div>
@section Scripts{


<script>

    $(document).ready(function () {
        getdata();
        debugger
        function getdata() {
            debugger
            var table = $("#customerTable").DataTable({
                "destroy": true,
                "serverSide": true,
                
               
                "ajax": {
                    url: '@Url.Action("GetAll", "Customer")',
                    type: "get",
                    data:function(x){
                            x.CustomerName = $('#CustomerName').val();
                    }
                },

                "columns": [

                    {
                        data: null, name: "CustomerName", render: function (data, type, row) {
                            return data.customerName ;
                        }, "orderable": true
                    },
                    {
                        data: null, name: "Mobile", render: function (data, type, row) {
                            return  data.mobile ;


                        }, "orderable": true
                    },                
                    {
                        data: null, name: "Address", render: function (data, type, row) {
                            return  data.address ;


                        }, "orderable": true
                    },
                    {
                        data: null, name: "Telephone", render: function (data, type, row) {
                            return data.telephone ;


                        }, "orderable": true
                    },
                    {
                        data: null, name: "Fax", render: function (data, type, row) {
                            return  data.fax ;


                        }, "orderable": true
                    },
                    {
                        data: null, name: "Category", render: function (data, type, row) {
                            return  data.category ;


                        }, "orderable": true
                    },
                        {
                            data: null, name: "Invoices", render: function (data, type, row) {
                                return '<a class="add" href="#" data-id="' + data.id + '">Add</a> ' + ' |' +
                                    '<a class="view" href="#" data-id="' + data.id + '"> View</a>';


                            }, "orderable": true
                        },
                 
                    {
                        data: null, name: "Action", render: function (data, type, row) {
                                return '<a class="edit" href="#" data-id="' + data.id + '">Edit</a> ' +' |'+
                                       '<a class="delete" href="#" data-id="' + data.id + '"> Delete</a>';


                        }, "orderable": true
                    }
                ]
            });

            
        }
     
            $(document).on("change", "#CustomerName", function () {
                getdata();
            });
  
    $('#addCustomerModal').modal({
    show: false 
    });
            $('#updateCustomerModal').modal({
           show: false 
        });
    
    $('#addCustomerButton').click(function () {
   
    $('#addCustomerModal').modal('show');
    });
   
    $('#saveCustomerButton').click(function () {
    // Get the form data and perform necessary actions
    var formData = $('#addCustomerForm').serialize();
    console.log(formData);

  
    $('#addCustomerModal').modal('hide');
    });
            $('#updateCustomerButton').click(function () {
            

                $('#updateCustomerModal').modal('hide');
        });
    $('.close').click(function () {
   
    $('#addCustomerModal').modal('hide');
    });
    $('#close').click(function () {
   
            $('#updateCustomerModal').modal('hide');
    });
        $('.close').click(function () {
         
            $('#updateCustomerModal').modal('hide');
        });
        $('#close').click(function () {
          
            $('#addCustomerModal').modal('hide');
        });
    });
        $(document).ready(function () {
            $('#saveCustomerButton').click(function() {
                debugger
                

             
                var formData = {
                    customerName: $('#customerName').val(),
                    mobile: $('#mobile').val(),
                    address: $('#address').val(),
                    telephone: $('#telephone').val(),
                    fax: $('#fax').val(),
                    category: $('#category').val()
                };

                // Send data to server using AJAX
                $.ajax({
                    url: '/Customer/Create',
                    type: 'POST',
                    data: formData,
                    success: function (result) {
                      
                        alert('Customer created successfully!');
                        location.reload();
                        
                        $('#addCustomerForm')[0].reset();
                      
                    },
                    error: function (xhr, status, error) {
                   
                        alert('Error creating customer: ' + error);
                    }
                });
            });
            $(document).on('click', '.delete', function () {
                var id = $(this).data('id');
                if (confirm('Are you sure you want to delete this record?')) {
                    var url = '/Customer/delete/' + id;
                    $.ajax({
                        url: url,
                        type: 'Delete',
                        success: function (result) {
                            location.reload();
                        },
                        error: function (xhr, status, error) {
                            alert('Error deleted customer: ');
                        }
                    });
                }
            });
            $(document).on('click', '.edit', function () {
               debugger

                var id = $(this).data('id');
                var url = '/Customer/edit/' + id;

               
                $('#updateCustomerModal').modal('show');

                // Send AJAX request to retrieve customer data
                $.ajax({
                    url: url,
                    type: 'PUT',
                    success: function (result) {
                        // Populate form fields with customer data
                        $('#ucustomerName').val(result.customerName);
                        $('#umobile').val(result.mobile);
                        $('#uaddress').val(result.address);
                        $('#utelephone').val(result.telephone);
                        $('#ufax').val(result.fax);
                        $('#ucategory').val(result.category);
                        $('#uid').val(result.id);
                    },
                    error: function (xhr, status, error) {
                       
                    }
                });
            });

            $('#updateCustomerButton').click(function () {
                debugger

                var id = $('#uid').val();
                
                var customer = {
                    customerName: $('#ucustomerName').val(),
                    mobile: $('#umobile').val(),
                    address: $('#uaddress').val(),
                    telephone: $('#utelephone').val(),
                    fax: $('#ufax').val(),
                    category: $('#ucategory').val(),
                    id: $('#uid').val()
                };

              
                $.ajax({
                    url: '/Customer/update',
                    type: 'POST',
                    data: customer,
                    success: function (result) {
                      
                        if(result){
                            location.reload();
                        
                        alert('Customer updated successfully!');
                        }

                        $('#updateCustomerForm')[0].reset();

                    },
                    error: function (xhr, status, error) {
                        // Handle error response
                        alert('Error updated customer: ');
                        $('#updateCustomerForm')[0].reset();
                    }
                });
            });
        });
    $(document).ready(function () {
        $('#exportButton').click(function () {
            
            $.ajax({
                url: '@Url.Action("ExportToExcel", "Customer")',
                type: 'GET',
                success: function () {
                    
                    alert('Export complete');
                },
                error: function () {
               
                    alert('Export failed');
                }
            });
        });
    });
    </script>
    }



























